/*! bookmark-browser 26-10-2016 08: */

function Bookmarks_PageBeforeShow(a,b){return localStorage.getItem("CurrentBookmarks")?(bmbCommon.clearMessagePanel("Bookmarks"),ko.dataFor($("#bookmarkContainer")[0])||(applyBindings(),$("#bookmarkContainer").show()),void $("#bmMain").listview("refresh")):(bmbCommon.displayMessage("Go to the Authentication page to enter your Sync credentials","Bookmarks"),void $("#bookmarkContainer").hide())}function Bookmarks_PageChangeFailed(a,b){}function doNavigation(a){var b,c,d;if("backButton"===a.id){if(b=$(a).attr("data-nodepath").split("\\"),b.pop(),0===b.length)return;2===b.length?(d="Root",c="Bookmarks"):(d=b.join("\\"),b.shift(),c=b[b.length-1]),$("#backButton").attr("data-nodepath",d)}else if("topButton"===a.id){if("Root"===$("#backButton").attr("data-nodepath"))return;c="Bookmarks",$("#backButton").attr("data-nodepath","Root")}else b=$(a).attr("data-nodepath").split("\\"),b.shift(),c=b[b.length-1],$("#backButton").attr("data-nodepath",$(a).attr("data-nodepath"));var e=JSON.parse(localStorage.getItem("CurrentBookmarks")),f=getNode(e.BookmarkItems,b);ko.dataFor($("#bookmarkContainer")[0]).setBookmarks(f),$("#bmHeader").html(c),$("body").pagecontainer("change","#Bookmarks",{transition:"fade",allowSamePageTransition:!0})}function getNode(a,b){var c,d=null;if(b){c=b.shift();for(var e=0;e<a.length;e++)if(a[e].Name===c&&0===a[e].ItemType){if(0===b.length){d=a[e];break}d=getNode(a[e].BookmarkItems,b);break}}return d}function Settings_PageBeforeShow(a,b){bmbCommon.clearMessagePanel("Settings"),loadSettingsPage()}function Settings_PageChangeFailed(a,b){}function loadSettingsPage(){var a=!1;"True"===localStorage.getItem("LastDirOnStartup")&&(a=!0),$("#lastDirOnStartup").prop("checked",a).checkboxradio("refresh")}function Save_OnClick(){var a="False",b=setTimeout(function(){$.mobile.loading("hide"),clearTimeout(b)},1e3);return $.mobile.loading("show",{theme:"c",text:"Saving ...",textVisible:!0,textonly:!0}),$("#lastDirOnStartup").prop("checked")&&(a="True"),localStorage.setItem("LastDirOnStartup",a),!1}function Auth_PageBeforeShow(a,b){bmbCommon.clearMessagePanel("Auth"),loadAuthPage()}function loadAuthPage(){var a=localStorage.getItem("CurrentBookmarks");a?($("#currentUser").html(localStorage.getItem("UserName")),$("#bookmarkCount").html(localStorage.getItem("BookmarkCount")),$("#lastRefresh").html(moment(localStorage.getItem("LastRefresh")).format("LLL")),$("#LoggedOutContainer").hide(),$("#LoggedInContainer").show(),$("#verificationLinkInput").hide(),$("#Login").hide(),$("#Refresh").show(),$("#Logout").show(),$("#Backup").show()):($("#userName").val(""),$("#password").val(""))}function Login_OnClick(){return Refresh_OnClick($("#userName").val(),$("#password").val())}function Logout_OnClick(){$.mobile.loading("show",{theme:"c"}),localStorage.removeItem("UserName"),localStorage.removeItem("Password"),localStorage.removeItem("CurrentBookmarks"),localStorage.removeItem("BookmarkCount"),localStorage.removeItem("LastRefresh"),localStorage.removeItem("CurrentNode"),sessionStorage.removeItem("CurrentNode"),$("#userName").val(""),$("#password").val(""),$("#LoggedInContainer").hide(),$("#LoggedOutContainer").show(),$("#verificationLinkInput").hide(),$("#verificationLink").val(""),$("#Login").show(),$("#Refresh").hide(),$("#Verify").hide(),$("#Logout").hide(),$("#Backup").hide(),bmbCommon.clearMessagePanel("Auth");var a=ko.dataFor($("#bookmarkContainer")[0]);return a&&a.removeBookmarks(),$.mobile.loading("hide"),$("body").pagecontainer("change","#Auth",{allowSamePageTransition:!0}),!1}function Refresh_OnClick(a,b){var c,d;return c=a?a:localStorage.getItem("UserName"),d=b?b:localStorage.getItem("Password"),c&&""!==c?d&&""!==d?(bmbCommon.clearMessagePanel("Auth"),$.mobile.loading("show",{theme:"c",text:"Authenticating ...",textVisible:!0}),bmbAPI.login(c,d),!1):(bmbCommon.displayMessage("Password cannot be blank","Auth"),!1):(bmbCommon.displayMessage("Username cannot be blank","Auth"),!1)}function VerifyLogin_OnClick(){var a=localStorage.getItem("UserName"),b=localStorage.getItem("Password"),c=(localStorage.getItem("KeyFetchToken"),localStorage.getItem("SessionToken"),$("#verificationLink").val());return c&&""!==c?(bmbCommon.clearMessagePanel("Auth"),$.mobile.loading("show",{theme:"c",text:"Loading ...",textVisible:!0}),bmbAPI.verifyLogin(c).then(function(c,d,e){bmbAPI.loadBookmarks(a,b)},function(a,b,c){bmbCommon.displayMessage(bmbCommon.getErrorMessage(a),"Auth")}),!1):(bmbCommon.displayMessage("Verification link cannot be blank","Auth"),!1)}function Backup_OnClick(){$.mobile.loading("show",{theme:"c",text:"Backing up data ...",textVisible:!0});var a=localStorage.getItem("UserName"),b=localStorage.getItem("Password"),c=localStorage.getItem("CurrentBookmarks");if(c){var d={};d.bookmarkData=c,d.count=localStorage.getItem("BookmarkCount"),d.lastRefresh=localStorage.getItem("LastRefresh"),$.ajax({type:"POST",url:"api/bookmark/backup?username="+encodeURIComponent(a)+"&password="+encodeURIComponent(b),contentType:"application/json; charset=utf-8",data:JSON.stringify(d),headers:{"cache-control":"no-cache"},success:function(a){bmbCommon.displayMessage("Data backed up successfully","Auth")},error:function(a){bmbCommon.displayMessage(bmbCommon.getErrorMessage(a),"Auth")}})}return!1}function Restore_OnClick(){var a=localStorage.getItem("UserName"),b=localStorage.getItem("Password");if(!a||!b){if(a=$("#userName").val(),b=$("#password").val(),!a)return bmbCommon.displayMessage("User name cannot be blank","Auth"),!1;if(!b)return bmbCommon.displayMessage("Password cannot be blank","Auth"),!1}return $.mobile.loading("show",{theme:"c",text:"Restoring data ...",textVisible:!0}),$.ajax({type:"GET",url:"api/bookmark/backup?username="+encodeURIComponent(a)+"&password="+encodeURIComponent(b),contentType:"application/json; charset=utf-8",dataType:"json",headers:{"cache-control":"no-cache"},success:function(c){var d=JSON.parse(c.Content);localStorage.setItem("CurrentBookmarks",d.bookmarkData),localStorage.setItem("BookmarkCount",d.count),localStorage.setItem("LastRefresh",d.lastRefresh),localStorage.setItem("UserName",a),localStorage.setItem("Password",b)},error:function(a){bmbCommon.displayMessage(bmbCommon.getErrorMessage(a),"Auth")}}),!1}function applyBindings(){ko.bindingHandlers.bookmarkItemType={init:function(a,b,c,d,e){$(a).find(".nameBlock").html(d.Name),0===d.ItemType?($(a).jqmData("icon","arrow-r"),$(a).find("a").attr("onclick","doNavigation(this);"),$(a).find("img").attr("src","Images/folder.png"),$(a).find(".locationBlock").hide()):1===d.ItemType?($(a).find("a").attr("target","_blank"),$(a).find("img").attr("src","Images/bookmark.png"),$(a).find(".locationBlock").html(d.Location).show()):2===d.ItemType}},ko.applyBindings(new bookmarksViewModel)}var bmbCommon=function(){function a(a){var b="";if(a)if(a.responseText&&""!=a.responseText)try{var c=JSON.parse(a.responseText);b=c.Message?c.Message:c.ExceptionMessage&&""!=c.ExceptionMessage?c.ExceptionMessage:c}catch(d){b=a.responseText}else b=a.statusText&&""!=a.statusText?a.statusText:a.message?a.message:a;return b}function b(a,b){$("#"+b).find(".errorNotification").html(a),$("#"+b).find(".msgPanel").css("display","block")}function c(a){$("#"+a).find(".errorNotification").html(""),$("#"+a).find(".msgPanel").css("display","none")}return{getErrorMessage:a,displayMessage:b,clearMessagePanel:c}}(),bmbAPI=function(a){function b(b,c){var d={Username:b,Password:c};return $.ajax({type:"POST",url:"api/login",contentType:"application/json; charset=utf-8",data:JSON.stringify(d),headers:{"cache-control":"no-cache"},success:function(a){localStorage.setItem("UserName",b),localStorage.setItem("Password",c),$("#userName").val(""),$("#password").val("");var d=JSON.parse(a.Content);localStorage.setItem("UID",d.Uid),localStorage.setItem("KeyFetchToken",d.KeyFetchToken),localStorage.setItem("SessionToken",d.SessionToken),$("#verificationLinkInput").show(),$("#Verify").show(),$("#Logout").show()},error:function(b){a.displayMessage(a.getErrorMessage(b),"Auth")}})}function c(b){var c={UID:localStorage.getItem("UID"),VerificationLink:b};return $.ajax({type:"POST",url:"api/verify",contentType:"application/json; charset=utf-8",data:JSON.stringify(c),headers:{"cache-control":"no-cache"},success:function(a){$("#verificationLink").val(""),$("#Login").hide(),$("#Refresh").show(),$("#Verify").hide(),$("#Logout").show(),$("#Backup").show(),localStorage.removeItem("UID")},error:function(b){a.displayMessage(a.getErrorMessage(b),"Auth")}})}function d(b,c){var d=localStorage.getItem("KeyFetchToken"),e=localStorage.getItem("SessionToken"),f="api/bookmark?username="+encodeURIComponent(b)+"&password="+encodeURIComponent(c);f+="&keyFetchToken="+d+"&sessionToken="+e,$.ajax({type:"GET",url:f,contentType:"application/json; charset=utf-8",dataType:"json",headers:{"cache-control":"no-cache"},success:function(a){var b=JSON.parse(a.Content);localStorage.setItem("CurrentBookmarks",a.Content),localStorage.setItem("BookmarkCount",b.Tag),localStorage.setItem("LastRefresh",(new Date).toISOString())},error:function(b){a.displayMessage(a.getErrorMessage(b),"Auth")}})}function e(a,b,c){c.url.indexOf("api/bookmark")>-1?(b.status<400&&(-1===c.url.indexOf("/backup")||c.url.indexOf("/backup")>-1&&"GET"===c.type)&&$("body").pagecontainer("change","#Bookmarks",{reload:!0}),$.mobile.loading("hide")):c.url.indexOf("api/login")>-1&&$.mobile.loading("hide")}return{login:b,verifyLogin:c,loadBookmarks:d,ajaxCompleted:e}}(bmbCommon),bookmarksViewModel=function(){var a,b,c,d=this,e=JSON.parse(localStorage.getItem("CurrentBookmarks")),f=localStorage.getItem("LastDirOnStartup");c=f&&"True"===f?localStorage.getItem("CurrentNode"):sessionStorage.getItem("CurrentNode"),c?(a=JSON.parse(c),$("#backButton").attr("data-nodepath",a.Path),b=a.Path.split("\\"),$("#bmHeader").html(b[b.length-1]),d.BookmarksToolbar=ko.observableArray(a.BookmarkItems),d.BookmarksMenu=ko.observableArray([]),$("#toolbarDivider").hide(),$("#menuDivider").hide()):(d.BookmarksToolbar=ko.observableArray(e.BookmarkItems[0].BookmarkItems),d.BookmarksMenu=ko.observableArray(e.BookmarkItems[1].BookmarkItems),$("#bmHeader").html("Bookmarks")),d.setBookmarks=function(a){a?(d.BookmarksToolbar(a.BookmarkItems),d.BookmarksMenu([]),sessionStorage.setItem("CurrentNode",JSON.stringify(a)),localStorage.setItem("CurrentNode",JSON.stringify(a)),$("#toolbarDivider").hide(),$("#menuDivider").hide()):(d.BookmarksToolbar(e.BookmarkItems[0].BookmarkItems),d.BookmarksMenu(e.BookmarkItems[1].BookmarkItems),sessionStorage.removeItem("CurrentNode"),localStorage.removeItem("CurrentNode"),$("#bmHeader").html("Bookmarks"),$("#toolbarDivider").show(),$("#menuDivider").show())},d.removeBookmarks=function(){d.BookmarksToolbar([]),d.BookmarksMenu([])}};
//# sourceMappingURL=/sourceMap.map