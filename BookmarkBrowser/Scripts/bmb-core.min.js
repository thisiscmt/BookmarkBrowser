/*! bookmark-browser 10-07-2016 06: */

function loadBookmarks(a,b,c){$.ajax({type:"GET",url:"api/bookmark?username="+encodeURIComponent(a)+"&password="+encodeURIComponent(b),contentType:"application/json; charset=utf-8",dataType:"json",headers:{"cache-control":"no-cache"},success:function(d){var e=JSON.parse(d.Content);localStorage.setItem("CurrentBookmarks",d.Content),localStorage.setItem("BookmarkCount",e.Tag),localStorage.setItem("LastRefresh",(new Date).toISOString());var f="False",g="False";"Login"!==c&&"Save"!=c||(localStorage.setItem("UserName",a),localStorage.setItem("Password",b),$("#loadOnStartup").prop("checked")&&(f="True"),$("#lastDirOnStartup").prop("checked")&&(g="True"),localStorage.setItem("LoadOnStartup",f),localStorage.setItem("LastDirOnStartup",g))},error:function(a){displayMessage(getErrorMessage(a),"Settings")}})}function ajaxCompleted(a,b,c){c.url.indexOf("api/bookmark")>-1&&(b.status<400&&(-1===c.url.indexOf("/backup")||c.url.indexOf("/backup")>-1&&"GET"===c.type)&&$("body").pagecontainer("change","#Bookmarks",{reload:!0}),$.mobile.loading("hide"))}function getErrorMessage(a){var b="";if(a)if(a.responseText&&""!=a.responseText)try{var c=JSON.parse(a.responseText);b=c.Message?c.Message:c.ExceptionMessage&&""!=c.ExceptionMessage?c.ExceptionMessage:c}catch(d){b=a.responseText}else b=a.statusText&&""!=a.statusText?a.statusText:a.message?a.message:a;return b}function displayMessage(a,b){$("#"+b).find(".errorNotification").html(a),$("#"+b).find(".msgPanel").css("display","block")}function clearMessagePanel(a){$("#"+a).find(".errorNotification").html(""),$("#"+a).find(".msgPanel").css("display","none")}function Bookmarks_PageBeforeShow(a,b){return localStorage.getItem("CurrentBookmarks")?(clearMessagePanel("Bookmarks"),ko.dataFor($("#bookmarkContainer")[0])||(applyBindings(),$("#bookmarkContainer").show()),void $("#bmMain").listview("refresh")):(displayMessage("Go to the Settings page to enter your Sync credentials","Bookmarks"),void $("#bookmarkContainer").hide())}function Bookmarks_PageChangeFailed(a,b){}function doNavigation(a){var b,c,d;if("backButton"===a.id){if(b=$(a).attr("data-nodepath").split("\\"),b.pop(),0===b.length)return;2===b.length?(d="Root",c="Bookmarks"):(d=b.join("\\"),b.shift(),c=b[b.length-1]),$("#backButton").attr("data-nodepath",d)}else if("topButton"===a.id){if("Root"===$("#backButton").attr("data-nodepath"))return;c="Bookmarks",$("#backButton").attr("data-nodepath","Root")}else b=$(a).attr("data-nodepath").split("\\"),b.shift(),c=b[b.length-1],$("#backButton").attr("data-nodepath",$(a).attr("data-nodepath"));var e=JSON.parse(localStorage.getItem("CurrentBookmarks")),f=getNode(e.BookmarkItems,b);ko.dataFor($("#bookmarkContainer")[0]).setBookmarks(f),$("#bmHeader").html(c),$("body").pagecontainer("change","#Bookmarks",{transition:"fade",allowSamePageTransition:!0})}function getNode(a,b){var c,d=null;if(b){c=b.shift();for(var e=0;e<a.length;e++)if(a[e].Name===c&&0===a[e].ItemType){if(0===b.length){d=a[e];break}d=getNode(a[e].BookmarkItems,b);break}}return d}function Settings_PageBeforeShow(a,b){clearMessagePanel("Settings"),loadSettingsPage()}function Settings_PageChangeFailed(a,b){}function loadSettingsPage(){var a=localStorage.getItem("UserName"),b=!1,c=!1;a?($("#currentUser").html(a),$("#bookmarkCount").html(localStorage.getItem("BookmarkCount")),$("#lastRefresh").html(moment(localStorage.getItem("LastRefresh")).format("LLL")),"True"===localStorage.getItem("LoadOnStartup")&&(b=!0),"True"===localStorage.getItem("LastDirOnStartup")&&(c=!0),$("#loadOnStartup").prop("checked",b).checkboxradio("refresh"),$("#lastDirOnStartup").prop("checked",c).checkboxradio("refresh"),$("#LoggedOutContainer").hide(),$("#LoggedInContainer").show(),$(".loggedIn").show()):($("#userName").val(""),$("#password").val(""),$("#loadOnStartup").prop("checked",!1).checkboxradio("refresh"),$("#lastDirOnStartup").prop("checked",!1).checkboxradio("refresh"))}function Save_OnClick(){var a,b,c="False",d="False";if(localStorage.getItem("CurrentBookmarks")){var e=setTimeout(function(){$.mobile.loading("hide"),clearTimeout(e)},1e3);$.mobile.loading("show",{theme:"c",text:"Saving ...",textVisible:!0,textonly:!0}),$("#loadOnStartup").prop("checked")&&(c="True"),$("#lastDirOnStartup").prop("checked")&&(d="True"),localStorage.setItem("LoadOnStartup",c),localStorage.setItem("LastDirOnStartup",d)}else{if(a=$("#userName").val(),b=$("#password").val(),!a)return displayMessage("User name cannot be blank","Settings"),!1;if(!b)return displayMessage("Password cannot be blank","Settings"),!1;clearMessagePanel("Settings"),$.mobile.loading("show",{theme:"c",text:"Loading ...",textVisible:!0}),loadBookmarks(a,b,"Login")}return!1}function Logout_OnClick(){$.mobile.loading("show",{theme:"c"}),localStorage.removeItem("UserName"),localStorage.removeItem("Password"),localStorage.removeItem("CurrentBookmarks"),localStorage.removeItem("BookmarkCount"),localStorage.removeItem("LastRefresh"),localStorage.removeItem("LoadOnStartup"),localStorage.removeItem("LastDirOnStartup"),localStorage.removeItem("CurrentNode"),sessionStorage.removeItem("CurrentNode"),$("#userName").val(""),$("#password").val(""),$(".loggedIn").hide(),$("#LoggedInContainer").hide(),$("#LoggedOutContainer").show();var a=ko.dataFor($("#bookmarkContainer")[0]);return a&&a.removeBookmarks(),$.mobile.loading("hide"),$("body").pagecontainer("change","#Settings",{allowSamePageTransition:!0}),!1}function Refresh_OnClick(){$.mobile.loading("show",{theme:"c",text:"Loading ...",textVisible:!0});var a=localStorage.getItem("UserName"),b=localStorage.getItem("Password");return loadBookmarks(a,b,"Refresh"),!1}function Backup_OnClick(){$.mobile.loading("show",{theme:"c",text:"Backing up data ...",textVisible:!0});var a=localStorage.getItem("UserName"),b=localStorage.getItem("Password"),c=localStorage.getItem("CurrentBookmarks");if(c){var d={};d.bookmarkData=c,d.count=localStorage.getItem("BookmarkCount"),d.lastRefresh=localStorage.getItem("LastRefresh"),$.ajax({type:"POST",url:"api/bookmark/backup?username="+encodeURIComponent(a)+"&password="+encodeURIComponent(b),contentType:"application/json; charset=utf-8",data:JSON.stringify(d),headers:{"cache-control":"no-cache"},success:function(a){displayMessage("Data backed up successfully","Settings")},error:function(a){displayMessage(getErrorMessage(a),"Settings")}})}return!1}function Restore_OnClick(){var a=localStorage.getItem("UserName"),b=localStorage.getItem("Password");if(!a||!b){if(a=$("#userName").val(),b=$("#password").val(),!a)return displayMessage("User name cannot be blank","Settings"),!1;if(!b)return displayMessage("Password cannot be blank","Settings"),!1}return $.mobile.loading("show",{theme:"c",text:"Restoring data ...",textVisible:!0}),$.ajax({type:"GET",url:"api/bookmark/backup?username="+encodeURIComponent(a)+"&password="+encodeURIComponent(b),contentType:"application/json; charset=utf-8",dataType:"json",headers:{"cache-control":"no-cache"},success:function(c){var d=JSON.parse(c.Content);localStorage.setItem("CurrentBookmarks",d.bookmarkData),localStorage.setItem("BookmarkCount",d.count),localStorage.setItem("LastRefresh",d.lastRefresh),localStorage.setItem("UserName",a),localStorage.setItem("Password",b)},error:function(a){displayMessage(getErrorMessage(a),"Settings")}}),!1}function applyBindings(){ko.bindingHandlers.bookmarkItemType={init:function(a,b,c,d,e){$(a).find(".nameBlock").html(d.Name),0===d.ItemType?($(a).jqmData("icon","arrow-r"),$(a).find("a").attr("onclick","doNavigation(this);"),$(a).find("img").attr("src","Images/folder.png"),$(a).find(".locationBlock").hide()):1===d.ItemType?($(a).find("a").attr("target","_blank"),$(a).find("img").attr("src","Images/bookmark.png"),$(a).find(".locationBlock").html(d.Location).show()):2===d.ItemType}},ko.applyBindings(new bookmarksViewModel)}var bookmarksViewModel=function(){var a,b,c,d=this,e=JSON.parse(localStorage.getItem("CurrentBookmarks")),f=localStorage.getItem("LastDirOnStartup");c=f&&"True"===f?localStorage.getItem("CurrentNode"):sessionStorage.getItem("CurrentNode"),c?(a=JSON.parse(c),$("#backButton").attr("data-nodepath",a.Path),b=a.Path.split("\\"),$("#bmHeader").html(b[b.length-1]),d.BookmarksToolbar=ko.observableArray(a.BookmarkItems),d.BookmarksMenu=ko.observableArray([]),$("#toolbarDivider").hide(),$("#menuDivider").hide()):(d.BookmarksToolbar=ko.observableArray(e.BookmarkItems[0].BookmarkItems),d.BookmarksMenu=ko.observableArray(e.BookmarkItems[1].BookmarkItems),$("#bmHeader").html("Bookmarks")),d.setBookmarks=function(a){a?(d.BookmarksToolbar(a.BookmarkItems),d.BookmarksMenu([]),sessionStorage.setItem("CurrentNode",JSON.stringify(a)),localStorage.setItem("CurrentNode",JSON.stringify(a)),$("#toolbarDivider").hide(),$("#menuDivider").hide()):(d.BookmarksToolbar(e.BookmarkItems[0].BookmarkItems),d.BookmarksMenu(e.BookmarkItems[1].BookmarkItems),sessionStorage.removeItem("CurrentNode"),localStorage.removeItem("CurrentNode"),$("#bmHeader").html("Bookmarks"),$("#toolbarDivider").show(),$("#menuDivider").show())},d.removeBookmarks=function(){d.BookmarksToolbar([]),d.BookmarksMenu([])}};
//# sourceMappingURL=/sourceMap.map